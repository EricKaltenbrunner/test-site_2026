<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio</title>

  <style>
    :root{
      --bg:#07090d;
      --panel: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.10);
      --text:#eef2ff;
      --muted: rgba(238,242,255,0.70);
      --accent: #7dd3fc;
      --accent2:#a78bfa;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 0%, rgba(125,211,252,0.16), transparent 60%),
        radial-gradient(900px 600px at 80% 10%, rgba(167,139,250,0.16), transparent 65%),
        var(--bg);
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 28px 18px 36px;
    }

    header{
      padding: 14px 0 18px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .titleRow{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 16px;
      flex-wrap:wrap;
    }

    .leftHead{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 240px;
    }

    h1{
      margin:0;
      font-size: 22px;
      letter-spacing: 0.3px;
      line-height: 1.1;
    }
    .tagline{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.4;
      max-width: 70ch;
    }

    .controls{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 6px;
    }

    .search{
      flex: 1 1 260px;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      outline: none;
      backdrop-filter: blur(8px);
    }
    .search::placeholder{ color: rgba(238,242,255,0.45); }

    .chip{
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      user-select:none;
      white-space: nowrap;
    }

    .status{
      margin-top: 12px;
      padding: 14px 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--panel);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      color: var(--muted);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(125,211,252,0.9);
      box-shadow: 0 0 18px rgba(125,211,252,0.6);
      flex:0 0 auto;
      animation: pulse 1.2s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(0.9); opacity:0.65; }
      50%{ transform: scale(1.1); opacity:1; }
    }

    .topNav{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 4px;
    }

    .crumbs{
      display:flex;
      align-items:center;
      gap: 8px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }
    .crumbs button{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      cursor:pointer;
      text-decoration:none;
      font-size: 12px;
    }
    .crumbs button:hover{
      color: var(--text);
      border-color: rgba(125,211,252,0.25);
    }

    /* Grid (folders + files) */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 12px;
      margin-top: 14px;
    }

    a.card, button.card{
      text-decoration:none;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(255,255,255,0.03);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      transition: transform 140ms ease, border-color 140ms ease, background 140ms ease;
      min-height: 110px;
      cursor:pointer;
      color: inherit;
      text-align:left;
    }
    a.card:hover, button.card:hover{
      transform: translateY(-2px);
      border-color: rgba(125,211,252,0.35);
      background: rgba(255,255,255,0.05);
    }

    .top{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width:0;
    }

    .badge{
      width: 38px;
      height: 38px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.03);
      color: var(--accent);
      font-weight: 800;
      letter-spacing: .5px;
      flex: 0 0 auto;
    }
    .badge.folder{ color: var(--accent2); }

    .meta{
      min-width:0;
      flex:1;
    }

    .name{
      font-size: 14px;
      font-weight: 650;
      color: var(--text);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .path{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-top: 2px;
    }

    .tags{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-top: 2px;
    }
    .tag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      color: rgba(238,242,255,0.78);
    }

    .thumb{
      margin-top: 2px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.10);
      overflow:hidden;
      background: rgba(0,0,0,0.25);
      aspect-ratio: 16/9;
      display:none;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    /* ‚úÖ Portfolio Gallery Mode (seamless scroll) */
    .gallery{
      margin-top: 14px;
      display:flex;
      flex-direction:column;
      gap: 0;            /* no vertical gaps */
    }
    .gallery img{
      width:100%;
      height:auto;
      display:block;      /* removes inline gaps */
      margin:0;
      padding:0;
      border:0;
      border-radius: 0;   /* seamless edges */
      box-shadow:none;
      background: transparent;
    }

    .empty{
      margin-top: 14px;
      padding: 18px;
      border-radius: var(--radius);
      border: 1px dashed rgba(255,255,255,0.18);
      color: var(--muted);
      background: rgba(255,255,255,0.02);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="titleRow">
        <div class="leftHead">
          <h1 id="pageTitle">Portfolio</h1>
          <p class="tagline" id="tagline">Click anything to open it. Image folders become scrollable galleries.</p>
        </div>
      </div>

      <div class="topNav">
        <div class="crumbs" id="crumbs"></div>
        <div class="controls" style="flex:1; justify-content:flex-end;">
          <input id="search" class="search" type="search" placeholder="Search‚Ä¶" />
          <div class="chip" id="countChip">0 items</div>
        </div>
      </div>
    </header>

    <div class="status" id="status">
      <div class="dot"></div>
      <div id="statusText">Loading‚Ä¶</div>
    </div>

    <div id="content">
      <div class="grid" id="grid"></div>
      <div class="gallery" id="gallery" style="display:none;"></div>
      <div class="empty" id="empty" style="display:none;">No results.</div>
    </div>
  </div>

  <script>
    const CONFIG = {
      owner: "",
      repo: "",
      branch: "",
      startPath: ""
    };

    const IMAGE_EXTS = new Set(["png","jpg","jpeg","webp","gif","svg","avif"]);
    const HIDE_FILES = new Set(["index.html"]);

    const $ = (id) => document.getElementById(id);

    const grid = $("grid");
    const gallery = $("gallery");
    const search = $("search");
    const statusText = $("statusText");
    const countChip = $("countChip");
    const emptyBox = $("empty");
    const statusBox = $("status");
    const crumbs = $("crumbs");
    const pageTitle = $("pageTitle");
    const tagline = $("tagline");

    let ctx = null;
    let dirChildren = new Map();
    let allFiles = [];
    let allDirs = new Set();
    let galleryDirs = new Set();
    let galleryThumb = new Map();

    function getQueryParams() {
      const p = new URLSearchParams(location.search);
      return {
        owner: p.get("owner") || "",
        repo: p.get("repo") || "",
        branch: p.get("branch") || "",
        startPath: p.get("startPath") || "",
        p: p.get("p") || ""
      };
    }

    function setRoutePath(p) {
      const url = new URL(location.href);
      if (p) url.searchParams.set("p", p);
      else url.searchParams.delete("p");
      history.pushState({}, "", url.toString());
      renderRoute();
      // nice touch: jump to top when entering a gallery/folder
      window.scrollTo({ top: 0, behavior: "instant" });
    }

    function detectPagesContext() {
      const host = location.hostname;
      if (!host.endsWith("github.io")) return { owner:"", repo:"", basePath:"/" };

      const owner = host.split(".")[0];
      const firstSeg = location.pathname.split("/").filter(Boolean)[0] || "";
      const repo = firstSeg ? firstSeg : `${owner}.github.io`;
      const basePath = firstSeg ? `/${firstSeg}/` : `/`;
      return { owner, repo, basePath };
    }

    function normalizeDir(p) {
      return (p || "").replace(/^\/+/, "").replace(/\/+$/, "");
    }

    function extOf(path) {
      const name = path.split("/").pop() || path;
      const i = name.lastIndexOf(".");
      return i >= 0 ? name.slice(i + 1).toLowerCase() : "";
    }

    function isImagePath(path) {
      return IMAGE_EXTS.has(extOf(path));
    }

    function iconTextForFile(path) {
      const ext = extOf(path);
      if (!ext) return "FILE";
      return ext.length <= 4 ? ext.toUpperCase() : ext.slice(0, 4).toUpperCase();
    }

    function formatBytes(bytes) {
      if (typeof bytes !== "number") return "";
      const units = ["B","KB","MB","GB"];
      let v = bytes, u = 0;
      while (v >= 1024 && u < units.length - 1) { v /= 1024; u++; }
      return `${v.toFixed(v >= 10 || u === 0 ? 0 : 1)} ${units[u]}`;
    }

    function buildPagesLink(basePath, filePath) {
      const cleanBase = basePath.endsWith("/") ? basePath : basePath + "/";
      return cleanBase + filePath.split("/").map(encodeURIComponent).join("/");
    }

    function labelForDir(dirPath) {
      const parts = dirPath.split("/").filter(Boolean);
      return parts.length ? parts[parts.length - 1] : "Home";
    }

    async function fetchDirContents(owner, repo, path, branch) {
      const enc = encodeURIComponent(path).replaceAll("%2F", "/");
      const url = new URL(`https://api.github.com/repos/${owner}/${repo}/contents/${enc}`);
      if (branch) url.searchParams.set("ref", branch);

      const res = await fetch(url.toString(), {
        headers: { "Accept": "application/vnd.github+json" }
      });

      if (!res.ok) throw new Error("Could not load items.");
      return res.json();
    }

    async function scanRepo({ owner, repo, branch, startPath }) {
      dirChildren.clear();
      allFiles = [];
      allDirs = new Set();
      galleryDirs = new Set();
      galleryThumb = new Map();

      const queue = [normalizeDir(startPath || "")];

      while (queue.length) {
        const dir = queue.shift();
        allDirs.add(dir);

        const items = await fetchDirContents(owner, repo, dir, branch);
        if (!Array.isArray(items)) continue;

        dirChildren.set(dir, items);

        let hasAny = false;
        let imageOnly = true;
        let firstImage = "";

        for (const item of items) {
          if (item.type === "dir") {
            imageOnly = false;
            queue.push(item.path);
            continue;
          }

          if (item.type === "file") {
            hasAny = true;
            allFiles.push({ path: item.path, name: item.name, size: item.size });

            if (!isImagePath(item.path)) imageOnly = false;
            else if (!firstImage) firstImage = item.path;
          }
        }

        if (hasAny && imageOnly) {
          galleryDirs.add(dir);
          if (firstImage) galleryThumb.set(dir, firstImage);
        }
      }
    }

    function isInGallery(filePath) {
      for (const g of galleryDirs) {
        if (!g) continue;
        if (filePath.startsWith(g + "/")) return true;
      }
      return false;
    }

    function getDirectChildren(dirPath) {
      const dir = normalizeDir(dirPath);
      const items = dirChildren.get(dir) || [];
      return items.filter(it => it.type === "dir" || (it.type === "file" && !HIDE_FILES.has(it.name)));
    }

    function getGalleryImages(dirPath) {
      const dir = normalizeDir(dirPath);
      const items = dirChildren.get(dir) || [];
      return items
        .filter(it => it.type === "file" && isImagePath(it.path))
        .map(it => it.path)
        .sort((a,b) => a.localeCompare(b));
    }

    function buildBreadcrumb(dirPath) {
      const dir = normalizeDir(dirPath);
      const parts = dir ? dir.split("/") : [];
      const out = [{ label: "Home", path: "" }];

      let acc = "";
      for (const part of parts) {
        acc = acc ? acc + "/" + part : part;
        out.push({ label: part, path: acc });
      }
      return out;
    }

    function setCount(n) {
      countChip.textContent = `${n} item${n === 1 ? "" : "s"}`;
    }

    function renderBreadcrumbs(dirPath) {
      const list = buildBreadcrumb(dirPath);
      crumbs.innerHTML = "";
      for (const c of list) {
        const btn = document.createElement("button");
        btn.textContent = c.label;
        btn.addEventListener("click", () => setRoutePath(c.path));
        crumbs.appendChild(btn);
      }
    }

    function renderGrid(items) {
      grid.innerHTML = "";
      gallery.style.display = "none";
      grid.style.display = "grid";

      const q = (search.value || "").trim().toLowerCase();

      const filtered = !q ? items : items.filter(it =>
        (it.title || "").toLowerCase().includes(q) ||
        (it.subtitle || "").toLowerCase().includes(q)
      );

      setCount(filtered.length);
      emptyBox.style.display = filtered.length ? "none" : "block";

      const frag = document.createDocumentFragment();

      for (const it of filtered) {
        if (it.kind === "folder" || it.kind === "gallery") {
          const b = document.createElement("button");
          b.className = "card";
          b.type = "button";
          b.addEventListener("click", () => setRoutePath(it.path));

          b.innerHTML = `
            <div class="top">
              <div class="badge folder">${it.kind === "gallery" ? "üì∑" : "üìÅ"}</div>
              <div class="meta">
                <div class="name" title="${it.title}">${it.title}</div>
                <div class="path" title="${it.subtitle}">${it.subtitle}</div>
                <div class="tags">
                  <span class="tag">${it.kind === "gallery" ? "gallery" : "folder"}</span>
                  ${it.countTag ? `<span class="tag">${it.countTag}</span>` : ""}
                </div>
              </div>
            </div>
            <div class="thumb"></div>
          `;

          if (it.thumb) {
            const thumb = b.querySelector(".thumb");
            thumb.style.display = "block";
            const img = document.createElement("img");
            img.loading = "lazy";
            img.src = buildPagesLink(ctx.basePath, it.thumb);
            img.alt = it.title;
            thumb.appendChild(img);
          }

          frag.appendChild(b);
          continue;
        }

        const a = document.createElement("a");
        a.className = "card";
        a.href = it.href;

        a.innerHTML = `
          <div class="top">
            <div class="badge">${it.badge}</div>
            <div class="meta">
              <div class="name" title="${it.title}">${it.title}</div>
              <div class="path" title="${it.subtitle}">${it.subtitle}</div>
              <div class="tags">${it.tagsHtml || ""}</div>
            </div>
          </div>
          <div class="thumb"></div>
        `;

        if (it.thumb) {
          const thumb = a.querySelector(".thumb");
          thumb.style.display = "block";
          const img = document.createElement("img");
          img.loading = "lazy";
          img.src = it.thumb;
          img.alt = it.title;
          thumb.appendChild(img);
        }

        frag.appendChild(a);
      }

      grid.appendChild(frag);
    }

    /* ‚úÖ Seamless gallery: just images, no frames, no captions, no open button */
    function renderGallery(dirPath) {
      grid.style.display = "none";
      gallery.style.display = "flex";
      gallery.innerHTML = "";

      const images = getGalleryImages(dirPath);
      setCount(images.length);
      emptyBox.style.display = images.length ? "none" : "block";

      const frag = document.createDocumentFragment();

      for (const imgPath of images) {
        const img = document.createElement("img");
        img.loading = "lazy";
        img.src = buildPagesLink(ctx.basePath, imgPath);
        img.alt = imgPath.split("/").pop() || "image";
        frag.appendChild(img);
      }

      gallery.appendChild(frag);
    }

    function buildRootItems() {
      const items = [];

      const galleries = Array.from(galleryDirs)
        .filter(d => d !== normalizeDir(CONFIG.startPath || ""))
        .sort((a,b) => a.localeCompare(b));

      for (const d of galleries) {
        const imgs = getGalleryImages(d);
        items.push({
          kind: "gallery",
          path: d,
          title: labelForDir(d),
          subtitle: d || "",
          thumb: galleryThumb.get(d) || "",
          countTag: `${imgs.length} photo${imgs.length === 1 ? "" : "s"}`
        });
      }

      const topDirs = Array.from(allDirs)
        .filter(d => d && d.split("/").length === 1)
        .filter(d => !galleryDirs.has(d))
        .sort((a,b) => a.localeCompare(b));

      for (const d of topDirs) {
        items.push({
          kind: "folder",
          path: d,
          title: labelForDir(d),
          subtitle: d,
          thumb: ""
        });
      }

      const fileCards = allFiles
        .filter(f => !HIDE_FILES.has(f.name))
        .filter(f => !isInGallery(f.path))
        .sort((a,b) => a.path.localeCompare(b.path))
        .map(f => {
          const ext = extOf(f.path);
          const sizeStr = formatBytes(f.size);
          const href = buildPagesLink(ctx.basePath, f.path);

          const tags = [];
          if (ext) tags.push(`<span class="tag">.${ext}</span>`);
          if (sizeStr) tags.push(`<span class="tag">${sizeStr}</span>`);

          let thumb = "";
          if (isImagePath(f.path)) thumb = href;

          return {
            kind: "file",
            title: f.name,
            subtitle: f.path,
            href,
            badge: iconTextForFile(f.path),
            tagsHtml: tags.join(""),
            thumb
          };
        });

      items.push(...fileCards);
      return items;
    }

    function buildFolderItems(dirPath) {
      const dir = normalizeDir(dirPath);
      const kids = getDirectChildren(dir);

      const subfolders = kids
        .filter(it => it.type === "dir")
        .map(it => {
          const isGallery = galleryDirs.has(it.path);
          const thumb = isGallery ? (galleryThumb.get(it.path) || "") : "";
          const count = isGallery ? getGalleryImages(it.path).length : null;

          return {
            kind: isGallery ? "gallery" : "folder",
            path: it.path,
            title: labelForDir(it.path),
            subtitle: it.path,
            thumb,
            countTag: (isGallery && count != null) ? `${count} photo${count === 1 ? "" : "s"}` : ""
          };
        })
        .sort((a,b) => a.title.localeCompare(b.title));

      const files = kids
        .filter(it => it.type === "file")
        .filter(it => !HIDE_FILES.has(it.name))
        .map(it => {
          const ext = extOf(it.path);
          const sizeStr = formatBytes(it.size);
          const href = buildPagesLink(ctx.basePath, it.path);

          const tags = [];
          if (ext) tags.push(`<span class="tag">.${ext}</span>`);
          if (sizeStr) tags.push(`<span class="tag">${sizeStr}</span>`);

          let thumb = "";
          if (isImagePath(it.path)) thumb = href;

          return {
            kind: "file",
            title: it.name,
            subtitle: it.path,
            href,
            badge: iconTextForFile(it.path),
            tagsHtml: tags.join(""),
            thumb
          };
        })
        .sort((a,b) => a.title.localeCompare(b.title));

      return [...subfolders, ...files];
    }

    function renderRoute() {
      const qp = getQueryParams();
      const currentPath = normalizeDir(qp.p || "");

      renderBreadcrumbs(currentPath);

      if (!currentPath) {
        pageTitle.textContent = "Portfolio";
        tagline.textContent = "Click anything to open it. Image folders become scrollable galleries.";
      } else {
        pageTitle.textContent = labelForDir(currentPath);
        tagline.textContent = galleryDirs.has(currentPath)
          ? "A seamless scroll through this series."
          : "Browse this folder.";
      }

      // ‚úÖ gallery mode
      if (currentPath && galleryDirs.has(currentPath)) {
        renderGallery(currentPath);
        return;
      }

      // folder mode
      if (currentPath) {
        const items = buildFolderItems(currentPath);
        renderGrid(items);
        return;
      }

      // root mode
      const rootItems = buildRootItems();
      renderGrid(rootItems);
    }

    (async function main() {
      try {
        statusText.textContent = "Building your portfolio‚Ä¶";

        const qp = getQueryParams();
        const detected = detectPagesContext();

        const owner = qp.owner || CONFIG.owner || detected.owner;
        const repo  = qp.repo  || CONFIG.repo  || detected.repo;
        const branch = qp.branch || CONFIG.branch || "";
        const startPath = qp.startPath || CONFIG.startPath || "";
        const basePath = detected.basePath || "/";

        if (!owner || !repo) {
          statusBox.style.display = "none";
          emptyBox.style.display = "block";
          emptyBox.textContent = "Source not configured.";
          return;
        }

        ctx = { owner, repo, branch, startPath, basePath };
        await scanRepo(ctx);

        statusBox.style.display = "none";
        renderRoute();

        search.addEventListener("input", () => renderRoute());
        window.addEventListener("popstate", () => renderRoute());
      } catch (e) {
        console.error(e);
        statusText.textContent = "Couldn‚Äôt load items.";
      }
    })();
  </script>
</body>
</html>
